#!/bin/bash

# Portfolio Risk - –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
# –°–∫—Ä–∏–ø—Ç –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤

echo "üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ Portfolio Risk Application..."
echo "========================================="

# –ü–µ—Ä–µ—Ö–æ–¥ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
cd "$(dirname "$0")"

echo "üîÑ –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤..."

# –ó–∞–≤–µ—Ä—à–∞–µ–º –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã
echo "   - –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ Spring Boot –ø—Ä–æ—Ü–µ—Å—Å–æ–≤..."
pkill -f "spring-boot" 2>/dev/null
pkill -f "mvnw" 2>/dev/null
pkill -f "TradeDiaryApplication" 2>/dev/null

echo "   - –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ Node.js/Vite –ø—Ä–æ—Ü–µ—Å—Å–æ–≤..."
pkill -f "vite" 2>/dev/null
pkill -f "npm.*dev" 2>/dev/null

# –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º –ø–æ—Ä—Ç—ã –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ
echo "   - –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –ø–æ—Ä—Ç–æ–≤..."
lsof -ti:8081 | xargs kill -9 2>/dev/null || true
lsof -ti:3000 | xargs kill -9 2>/dev/null || true

# –î–∞–µ–º –≤—Ä–µ–º—è –Ω–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ
sleep 3

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –ø–æ—Ä—Ç—ã —Å–≤–æ–±–æ–¥–Ω—ã
if lsof -Pi :8081 -sTCP:LISTEN -t >/dev/null ; then
    echo "‚ö†Ô∏è  –ü–æ—Ä—Ç 8081 –≤—Å–µ –µ—â–µ –∑–∞–Ω—è—Ç"
else
    echo "‚úÖ –ü–æ—Ä—Ç 8081 –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω"
fi

if lsof -Pi :3000 -sTCP:LISTEN -t >/dev/null ; then
    echo "‚ö†Ô∏è  –ü–æ—Ä—Ç 3000 –≤—Å–µ –µ—â–µ –∑–∞–Ω—è—Ç"
else
    echo "‚úÖ –ü–æ—Ä—Ç 3000 –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω"
fi

echo ""
echo "üèÅ Portfolio Risk –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"

read -p "–ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –≤—ã—Ö–æ–¥–∞..." 