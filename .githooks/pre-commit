#!/bin/sh

echo "ğŸ” Running pre-commit checks..."

# Frontend checks
echo "ğŸ“± Checking frontend..."
cd frontend

# Check if package.json exists
if [ -f "package.json" ]; then
    # Run ESLint
    echo "ğŸ”§ Running ESLint..."
    npm run lint
    if [ $? -ne 0 ]; then
        echo "âŒ ESLint failed. Please fix the issues before committing."
        exit 1
    fi

    # Check Prettier formatting
    echo "ğŸ’… Checking Prettier formatting..."
    npm run format:check
    if [ $? -ne 0 ]; then
        echo "âŒ Code is not properly formatted. Run 'npm run format' to fix."
        exit 1
    fi

    # Run tests
    echo "ğŸ§ª Running frontend tests..."
    npm run test:run
    if [ $? -ne 0 ]; then
        echo "âŒ Frontend tests failed. Please fix before committing."
        exit 1
    fi
fi

cd ..

# Backend checks
echo "â˜• Checking backend..."
cd backend

# Check if pom.xml exists
if [ -f "pom.xml" ]; then
    # Run Checkstyle
    echo "ğŸ”§ Running Checkstyle..."
    ./mvnw checkstyle:check
    if [ $? -ne 0 ]; then
        echo "âŒ Checkstyle failed. Please fix the issues before committing."
        exit 1
    fi

    # Run tests
    echo "ğŸ§ª Running backend tests..."
    ./mvnw test
    if [ $? -ne 0 ]; then
        echo "âŒ Backend tests failed. Please fix before committing."
        exit 1
    fi
fi

cd ..

echo "âœ… All pre-commit checks passed!"
exit 0 