#!/bin/sh

echo "🔍 Running pre-commit checks..."

# Frontend checks
echo "📱 Checking frontend..."
cd frontend

# Check if package.json exists
if [ -f "package.json" ]; then
    # Run ESLint
    echo "🔧 Running ESLint..."
    npm run lint
    if [ $? -ne 0 ]; then
        echo "❌ ESLint failed. Please fix the issues before committing."
        exit 1
    fi

    # Check Prettier formatting
    echo "💅 Checking Prettier formatting..."
    npm run format:check
    if [ $? -ne 0 ]; then
        echo "❌ Code is not properly formatted. Run 'npm run format' to fix."
        exit 1
    fi

    # Run tests
    echo "🧪 Running frontend tests..."
    npm run test:run
    if [ $? -ne 0 ]; then
        echo "❌ Frontend tests failed. Please fix before committing."
        exit 1
    fi
fi

cd ..

# Backend checks
echo "☕ Checking backend..."
cd backend

# Check if pom.xml exists
if [ -f "pom.xml" ]; then
    # Run Checkstyle
    echo "🔧 Running Checkstyle..."
    ./mvnw checkstyle:check
    if [ $? -ne 0 ]; then
        echo "❌ Checkstyle failed. Please fix the issues before committing."
        exit 1
    fi

    # Run tests
    echo "🧪 Running backend tests..."
    ./mvnw test
    if [ $? -ne 0 ]; then
        echo "❌ Backend tests failed. Please fix before committing."
        exit 1
    fi
fi

cd ..

echo "✅ All pre-commit checks passed!"
exit 0 